#### 查询接口耗时

```
# 查询平均耗时
awk '{print $9,$15}' /data/logs/as-home/as-home.log | awk -F '[[ :]+' '{print $2, $4}' | awk -F ']' 'NR>1{a[$1]++;b[$1]+=$2}END{for (i in a) printf "%s %s %.2f\n",a[i],i,b[i]/a[i]}' | sort -nr | head -n50
#单个接口耗时
grep 'getRecommendSkus' /data/logs/as-item/as-item.log.info.2019-07-16-10 | awk -F ':' 'BEGIN{sum=0; i=0} {sum+=$NF;i++} END{print sum/i}'
22.5275
# 查询某段时间的平均耗时
cat /data/logs/as-home/as-home.log | grep '2019-06-15 14:3' |  awk '{print $9,$15}'| awk -F '[[ :]+' '{print $2, $4}' | awk -F ']' 'NR>1{a[$1]++;b[$1]+=$2}END{for (i in a) printf "%s %s %.2f\n",a[i],i,b[i]/a[i]}' | sort -nr | head -n50
#查询某段时间的耗时大于1000
cat /data/logs/as-home/as-home.log | awk '{print $2,$3,$7,$8,$(NF-1)}' | awk -F 'total:' '{if($2 > 1000) print $0}'
#查询首页接口请求参数
grep '119.103.6.29' /data/logs/as-home/as-home.log.2019-04-22-11 | awk '{print $2,$3,$7,$8,$10,$(NF-1)}' | awk -F ',"' '{print $1,$11,$12,$13,$14,$16}'
#查询模块耗时超过500ms的分布
grep 'cost' /data/logs/as-home/as-home.log.info.2019-05-13-19  | awk -F ']' '{print $NF}' | awk -F 'cost:' '{print $1,$2}'| awk -F 'size' '{print $1}' | awk '{if($NF > 500) print $1}' | sort|uniq -c|sort -nr | head -n 10
#查询info日志中耗时大于500ms最多的前十条
grep 'cost' /data/logs/as-home/as-home.log.info.2019-05-13-19  | awk -F ']' '{print $NF}' | awk -F 'cost:' '{print $1,$2}'| awk -F 'size' '{print $1}' | awk '{if($NF > 500) print $1}' | sort|uniq -c|sort -nr | head -n 10

grep " 20:1" /data/logs/as-home/as-home.log | grep "indexPage" | awk '{split($(NF-1),a,":"); if(a[2]>200) print a[2]}'
# 查询访问较高的ip
cat a.txt | awk -F 'remote_ip:' '{print $NF}' | awk -F '\"' '{print $1}' | sort | uniq -c | sort -nr | head -n10
#查询平均耗时
awk '{print $8,$14}' /data/logs/mis-center/mis-center.log | awk -F '[[ :]+' '{print $2, $4}' | awk -F ']' 'NR>1{a[$1]++;b[$1]+=$2}END{for (i in a) printf "%s\t%.2f\t%s\n",a[i],b[i]/a[i],i}' | sort -nr | head -n50
#资源位耗时高于400ms
grep whc /data/logs/as-home/as-home.log.info | awk '{split($(NF),a,":");if(a[2] > 400) print $(NF-1),a[2]}'
```

 jvm参数修改
http://wiki.missfresh.net/pages/viewpage.action?pageId=46485326

命令快捷键
https://www.linuxidc.com/Linux/2018-10/154723.htm



```
dubbo摘流量
curl --connect-timeout 5 -m 5 http://10.10.100.68:9876/assist/dubbo/provider/disable?urls=
dubbo挂流量
curl --connect-timeout 5 -m 5 http://10.10.100.68:9876/assist/dubbo/provider/enable?urls=
```

```
grep '�' /data/logs/as-home/as-home.log | awk -F '&screen_width' '{print $1}' | awk -F 'version=' '{print $2}' | sort | uniq -c | sort -nr

grep '�' /data/logs/as-home/as-home.log | awk -F '&screen_width' '{print $1}' | awk -F ' ' '{print $8}' | sort | uniq -c | sort -nr

cat /data/logs/as-home/as-home.log | awk -F 'url' '{print $1}' | awk -F ' ' '{print $1}' | sort | uniq -c | sort -nr


cat /data/logs/home-center/home-center.log.wf | awk -F 'url' '{print $1}' | less

cat /data/logs/home-center/home-center.log.wf | awk -F 'url' '{print $1}' | awk -F ' ' '{print $1}' | sort | uniq -c | sort -nr

grep 'start time:' /data/logs/product-center/product-center.log.wf.2019-04-30-11 | awk '{print $1}' | awk -F ':' '{print $1,$2}'|  sort | uniq -c | sort -

grep 'start time:' /data/logs/product-center/product-center.log.wf.2019-04-30-11 | awk -F 'start time:' '{print $2}' | awk '{print $2}'  | awk -F ':' '{print $1,$2}'|  sort | uniq -c | sort -nr

grep 'start time:' /data/logs/product-center/product-center.log.wf | awk -F 'start time:' '{print $2}' | awk '{print $2}'  | awk -F ':' '{print $1,$2}'|  sort | uniq -c | sort -nr

```

查看链接机器端口的ip地址

```
netstat -an | grep 6379 | awk -F '6379' '{print $2}' | awk -F ':' '{print $1}' | sort | uniq -c | sort -nr | head -n 50
```

查询当前在线userId

```
cat test.text | awk -F 'userId=' '{print $NF}' | awk -F ',' '{print $1}' | sort | uniq -c
```

